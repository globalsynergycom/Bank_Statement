<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Загрузка банковской выписки → GitHub Inbox</title>
  <style>
    :root{--brand:#0b3d91;--bg:#f7f9fc;--border:#dfe3eb;--text:#111;--muted:#555}
    body{font-family:Inter,system-ui,Arial,sans-serif;max-width:760px;margin:40px auto;padding:0 12px;color:var(--text)}
    h1{color:var(--brand);margin:0 0 14px}
    .card{background:var(--bg);border:1px solid var(--border);border-radius:14px;padding:18px}
    .btn{display:inline-block;padding:10px 16px;border-radius:10px;border:1px solid var(--brand);background:var(--brand);color:#fff;cursor:pointer}
    .btn.secondary{background:#fff;color:var(--brand)}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin:12px 0}
    input[type=file]{padding:8px;border:1px solid var(--border);border-radius:10px;width:100%;background:#fff}
    .hint{color:var(--muted);font-size:14px}
    .ok{color:#0b7a2a}.err{color:#b00020}
    .mono{font-family:ui-monospace,Menlo,Consolas,monospace}
  </style>
</head>
<body>
  <h1>Загрузка выписки → GitHub /inbox</h1>
  <div class="card">
    <p>Принимаем <b>.xlsx</b>, <b>.xls</b> и <b>.csv</b>. Файл попадёт в репозиторий в папку <code class="mono">/inbox</code>, где GitHub Actions его нормализует и сохранит результат в <code class="mono">/outbox</code>.</p>

    <form id="form" onsubmit="return upload(event)">
      <div class="row">
        <input id="file" type="file" name="file" accept=".xlsx,.xls,.csv" required>
      </div>
      <div class="row">
        <button id="btn" class="btn" type="submit">Загрузить</button>
        <button type="button" class="btn secondary" onclick="resetForm()">Очистить</button>
      </div>
      <div id="status" class="hint"></div>
    </form>

    <p class="hint">После коммита можно посмотреть результат в папке <code class="mono">/outbox</code> (обычно 10–60 сек).</p>
  </div>

  <script>
    // 1) Укажите адрес вашего Worker API
    const UPLOAD_URL = 'https://<ВАШ-WORKER>.workers.dev/upload';

    function resetForm(){ document.getElementById('form').reset(); document.getElementById('status').textContent=''; }
    async function upload(e){
      e.preventDefault();
      const f = document.getElementById('file').files[0];
      if(!f){ return; }
      const btn = document.getElementById('btn');
      const status = document.getElementById('status');
      btn.disabled = true; btn.textContent = 'Отправляем…'; status.textContent = 'Загрузка файла…';

      const fd = new FormData(); fd.append('file', f);
      try{
        const res = await fetch(UPLOAD_URL, { method:'POST', body: fd });
        const data = await res.json();
        if(!res.ok) throw new Error(data.error || ('HTTP '+res.status));
        status.innerHTML = `✅ Готово. Коммит: <a target="_blank" href="${data.web_url}">${data.path}</a>`;
        status.className = 'hint ok';
      }catch(err){
        status.textContent = 'Ошибка: '+ err.message;
        status.className = 'hint err';
      }finally{
        btn.disabled = false; btn.textContent = 'Загрузить';
      }
      return false;
    }
  </script>
</body>
</html>
